<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>NFS Web â€“ Single File</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
html,body{margin:0;overflow:hidden;background:black}
#ui{position:fixed;top:10px;left:10px;color:#0f0;font-family:monospace}
</style>
</head>
<body>

<div id="ui">
Speed: <span id="spd">0</span><br>
Nitro: <span id="nit">100</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
/* =======================
   EXTERNAL SERVER LOAD
======================= */

let carStats = {
  maxSpeed: 220,
  accel: 12,
  handling: 0.03,
  nitro: 40
};

fetch("https://raw.githubusercontent.com/microsoft/PowerBI-Developer-Samples/master/assets/sampledata.json")
.then(r=>r.json())
.then(data=>{
  // simulate server tuning
  carStats.maxSpeed = 260;
  carStats.accel = 16;
  carStats.handling = 0.04;
  carStats.nitro = 60;
  console.log("Loaded from server:",carStats);
});

/* =======================
   THREE SETUP
======================= */

const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000,10,80);

const camera = new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,500);
camera.position.set(0,4,10);

const renderer = new THREE.WebGLRenderer({antialias:false});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.HemisphereLight(0x00ffff,0x080820,1));

/* =======================
   ROAD
======================= */

const roadGeo = new THREE.PlaneGeometry(2000,20);
const roadMat = new THREE.MeshStandardMaterial({
 color:0x111111,
 metalness:0.8,
 roughness:0.3
});
const road = new THREE.Mesh(roadGeo,roadMat);
road.rotation.x = -Math.PI/2;
scene.add(road);

/* =======================
   CAR
======================= */

const car = new THREE.Mesh(
 new THREE.BoxGeometry(2,0.8,4),
 new THREE.MeshStandardMaterial({
  color:0xffaa00,
  metalness:0.9,
  roughness:0.2
 })
);
car.position.y=0.4;
scene.add(car);

/* =======================
   PHYSICS
======================= */

let speed=0;
let nitro=100;
let keys={};

addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

/* =======================
   GAME LOOP
======================= */

let last=performance.now();

function loop(t){
 const dt=(t-last)/1000;
 last=t;

 // ACCEL
 if(keys["w"]) speed += carStats.accel * dt;
 if(keys["s"]) speed -= carStats.accel * dt;

 // NITRO
 if(keys[" "] && nitro>0){
   speed += carStats.nitro * dt;
   nitro -= 30*dt;
 }

 speed *= 0.99;

 if(speed > carStats.maxSpeed) speed = carStats.maxSpeed;
 if(speed < -50) speed = -50;

 // STEER
 if(keys["a"]) car.rotation.y += carStats.handling * speed * dt;
 if(keys["d"]) car.rotation.y -= carStats.handling * speed * dt;

 // MOVE
 const forward = new THREE.Vector3(0,0,-1).applyQuaternion(car.quaternion);
 car.position.addScaledVector(forward,speed*dt);

 // CAMERA
 camera.position.lerp(
   car.position.clone().add(new THREE.Vector3(0,5,12).applyQuaternion(car.quaternion)),
   0.08
 );
 camera.lookAt(car.position);

 document.getElementById("spd").innerText = speed.toFixed(0);
 document.getElementById("nit").innerText = nitro.toFixed(0);

 renderer.render(scene,camera);
 requestAnimationFrame(loop);
}

loop(last);

addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
