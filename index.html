<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roblox Uz - Premium Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --accent: #00f2ff;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            margin: 0; font-family: 'Outfit', sans-serif;
            background: var(--bg); color: #fff;
            overflow: hidden; height: 100vh;
        }

        /* --- MODERN HUB INTERFACE --- */
        #hub {
            display: flex; flex-direction: column; align-items: center;
            padding: 40px 20px; height: 100%;
            background: radial-gradient(circle at center, #111 0%, #050505 100%);
        }
        .header-logo {
            font-size: 32px; font-weight: 900; letter-spacing: -1px;
            background: linear-gradient(to bottom, #fff, #888);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }
        .grid {
            display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 350px;
        }
        .game-card {
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 20px; padding: 20px; display: flex; align-items: center;
            gap: 20px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .game-card:active { transform: scale(0.97); background: rgba(255,255,255,0.08); border-color: var(--accent); }
        .icon-box { font-size: 40px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); }
        .info h3 { margin: 0; font-size: 18px; font-weight: 700; }
        .info p { margin: 5px 0 0; font-size: 12px; color: #666; font-weight: 400; }

        /* --- GAME ENGINE OVERLAY --- */
        #stage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: none; z-index: 100;
        }
        canvas { display: block; }
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; padding: 25px; display: flex; flex-direction: column;
            justify-content: space-between; align-items: center; z-index: 101;
        }
        .score { font-size: 60px; font-weight: 900; opacity: 0.2; }
        .top-bar { width: 100%; display: flex; justify-content: space-between; pointer-events: auto; }
        .btn-close {
            background: var(--glass); border: 1px solid var(--border);
            color: #fff; padding: 10px 20px; border-radius: 12px; font-weight: 700;
        }
        .message { font-size: 20px; font-weight: 700; text-align: center; }
    </style>
</head>
<body>

    <div id="hub">
        <div class="header-logo">ROBLOX UZ</div>
        <div class="grid">
            <div class="game-card" onclick="start('flappy')">
                <div class="icon-box">üê¶</div>
                <div class="info">
                    <h3 data-key="t1">Flappy Velocity</h3>
                    <p data-key="d1">Pro Physics Engine</p>
                </div>
            </div>
            <div class="game-card" onclick="start('stack')">
                <div class="icon-box">üß±</div>
                <div class="info">
                    <h3 data-key="t2">Perfect Stack</h3>
                    <p data-key="d2">High Precision Timing</p>
                </div>
            </div>
            <div class="game-card" onclick="start('knife')">
                <div class="icon-box">üéØ</div>
                <div class="info">
                    <h3 data-key="t3">Knife Master</h3>
                    <p data-key="d3">Tactile Hit Response</p>
                </div>
            </div>
        </div>
    </div>

    <div id="stage">
        <div class="ui-layer">
            <div class="top-bar">
                <button class="btn-close" onclick="closeGame()" id="exit-btn">EXIT</button>
            </div>
            <div class="score" id="score-val">0</div>
            <div class="message" id="msg-layer">TAP TO START</div>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // üåê LINGUALS
        const lang = {
            uz: {t1:"Flappy Velocity", d1:"Professional Fizika", t2:"Perfect Stack", d2:"Yuqori Aniqlik", t3:"Knife Master", d3:"Taktil Sezgi", exit:"Chiqish", start:"BOSHLASH", over:"O'YIN TUGADI"},
            ru: {t1:"Flappy Velocity", d1:"–ü—Ä–æ-–§–∏–∑–∏–∫–∞", t2:"Perfect Stack", d2:"–í—ã—Å–æ–∫–∞—è –¢–æ—á–Ω–æ—Å—Ç—å", t3:"Knife Master", d3:"–¢–∞–∫—Ç–∏–ª—å–Ω—ã–π –û—Ç–∫–ª–∏–∫", exit:"–í—ã—Ö–æ–¥", start:"–ù–ê–ñ–ú–ò–¢–ï", over:"–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê"},
            en: {t1:"Flappy Velocity", d1:"Pro Physics Engine", t2:"Perfect Stack", d2:"High Precision Timing", t3:"Knife Master", d3:"Tactile Hit Response", exit:"EXIT", start:"TAP TO START", over:"GAME OVER"}
        };
        const L = lang[tg.initDataUnsafe?.user?.language_code === 'uz' ? 'uz' : (tg.initDataUnsafe?.user?.language_code === 'ru' ? 'ru' : 'en')];
        
        // Apply texts
        document.querySelectorAll('[data-key]').forEach(el => el.innerText = L[el.getAttribute('data-key')]);
        document.getElementById('exit-btn').innerText = L.exit;

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score-val');
        const msgEl = document.getElementById('msg-layer');
        let gameId, mode = null, score = 0, state = 'menu';

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();

        function start(m) {
            mode = m; state = 'start';
            document.getElementById('hub').style.display = 'none';
            document.getElementById('stage').style.display = 'block';
            msgEl.innerText = L.start; scoreEl.innerText = '0';
            if(m === 'flappy') flappyInit();
            if(m === 'stack') stackInit();
            if(m === 'knife') knifeInit();
        }

        function closeGame() {
            cancelAnimationFrame(gameId);
            document.getElementById('hub').style.display = 'flex';
            document.getElementById('stage').style.display = 'none';
            mode = null;
        }

        function haptic(s) { tg.HapticFeedback.impactOccurred(s); }

        // ==========================================================
        // üê¶ FLAPPY VELOCITY (Advanced Fluid Physics)
        // ==========================================================
        function flappyInit() {
            let bird = {y: canvas.height/2, v: 0, r: 15, rot: 0};
            let pipes = [], frame = 0; score = 0;
            const gravity = 0.5, jump = -8, gap = 180;

            function run() {
                ctx.fillStyle = '#0a0a0a'; ctx.fillRect(0,0,canvas.width,canvas.height);
                // Grid Background
                ctx.strokeStyle = '#111'; ctx.lineWidth = 1;
                for(let i=0; i<canvas.width; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }
                
                if(state === 'play') {
                    bird.v += gravity; bird.y += bird.v;
                    bird.rot = Math.min(Math.PI/4, Math.max(-Math.PI/4, bird.v * 0.08));
                    if(frame++ % 90 === 0) pipes.push({x: canvas.width, h: Math.random()*(canvas.height-gap-200)+100, p: false});
                    
                    pipes.forEach((p, i) => {
                        p.x -= 4;
                        ctx.fillStyle = '#1a1a1a'; ctx.strokeStyle = varColor();
                        ctx.fillRect(p.x, 0, 60, p.h); ctx.strokeRect(p.x, 0, 60, p.h);
                        ctx.fillRect(p.x, p.h+gap, 60, canvas.height); ctx.strokeRect(p.x, p.h+gap, 60, canvas.height);
                        
                        if(bird.y+bird.r > canvas.height || bird.y-bird.r < 0 || (bird.x+bird.r > p.x && bird.x-bird.r < p.x+60 && (bird.y-bird.r < p.h || bird.y+bird.r > p.h+gap))) {
                            state = 'over'; haptic('heavy'); msgEl.innerText = L.over;
                        }
                        if(p.x+60 < bird.x && !p.p) { score++; scoreEl.innerText = score; p.p = true; haptic('light'); }
                    });
                    pipes = pipes.filter(p => p.x > -100);
                }

                // Draw Bird (Neon Style)
                ctx.save(); ctx.translate(canvas.width*0.25, bird.y); ctx.rotate(bird.rot);
                ctx.shadowBlur = 15; ctx.shadowColor = varColor(); ctx.fillStyle = '#fff';
                ctx.beginPath(); ctx.arc(0,0,bird.r,0,Math.PI*2); ctx.fill();
                ctx.restore(); ctx.shadowBlur = 0;

                gameId = requestAnimationFrame(run);
            }
            canvas.onclick = () => { 
                if(state === 'start') { state = 'play'; msgEl.innerText = ''; }
                if(state === 'play') { bird.v = jump; haptic('soft'); }
                if(state === 'over') flappyInit();
            };
            run();
        }

        // ==========================================================
        // üß± PERFECT STACK (Interpolated Camera & Color Lerp)
        // ==========================================================
        function stackInit() {
            let boxes = [], speed = 4, stateStack = 'start'; score = 0;
            const bH = 35, bW = 160;
            boxes.push({x: (canvas.width-bW)/2, w: bW, y: canvas.height-100, c: 200});
            let cur = {x: 0, w: bW, y: canvas.height-100-bH, dir: 1, c: 210};

            function run() {
                let grad = ctx.createLinearGradient(0,0,0,canvas.height);
                grad.addColorStop(0, '#050505'); grad.addColorStop(1, `hsl(${(score*10)%360}, 20%, 10%)`);
                ctx.fillStyle = grad; ctx.fillRect(0,0,canvas.width,canvas.height);

                if(stateStack === 'play') {
                    cur.x += speed * cur.dir;
                    if(cur.x > canvas.width-50 || cur.x < -cur.w+50) cur.dir *= -1;
                }

                let camY = (boxes.length * bH) - canvas.height/2;
                ctx.save(); ctx.translate(0, camY > 0 ? camY : 0);
                
                boxes.forEach(b => {
                    ctx.fillStyle = `hsl(${b.c}, 70%, 50%)`;
                    ctx.fillRect(b.x, b.y, b.w, b.h);
                    ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.strokeRect(b.x, b.y, b.w, b.h);
                });
                
                if(stateStack !== 'over') {
                    ctx.fillStyle = `hsl(${cur.c}, 70%, 50%)`;
                    ctx.fillRect(cur.x, cur.y, cur.w, cur.h);
                }
                ctx.restore();
                gameId = requestAnimationFrame(run);
            }

            canvas.onclick = () => {
                if(stateStack === 'start') { stateStack = 'play'; msgEl.innerText = ''; return; }
                if(stateStack === 'over') { stackInit(); return; }

                let prev = boxes[boxes.length-1];
                let diff = cur.x - prev.x;
                if(Math.abs(diff) >= cur.w) { stateStack = 'over'; haptic('heavy'); msgEl.innerText = L.over; return; }

                let newW = cur.w - Math.abs(diff);
                let newX = diff > 0 ? cur.x : prev.x;
                boxes.push({x: newX, w: newW, y: cur.y, c: cur.c});
                score++; scoreEl.innerText = score; haptic('medium'); speed += 0.1;
                cur = {x: Math.random()>0.5?0:canvas.width-newW, w: newW, y: cur.y-bH, dir: 1, c: 200+(score*10)};
            };
            run();
        }

        // ==========================================================
        // üéØ KNIFE MASTER (Hit Impact & Screen Shake)
        // ==========================================================
        function knifeInit() {
            let log = {a: 0, v: 0.03, knives: [], shake: 0}; score = 0;
            let currentKnifeY = canvas.height-150, isFiring = false;

            function run() {
                ctx.fillStyle = '#050505'; ctx.fillRect(0,0,canvas.width,canvas.height);
                
                // Shake effect logic
                if(log.shake > 0) { ctx.save(); ctx.translate(Math.random()*log.shake, Math.random()*log.shake); log.shake *= 0.8; }

                log.a += log.v;
                // Draw Log
                ctx.save(); ctx.translate(canvas.width/2, 250); ctx.rotate(log.a);
                ctx.fillStyle = '#111'; ctx.strokeStyle = varColor(); ctx.lineWidth=4;
                ctx.beginPath(); ctx.arc(0,0,90,0,Math.PI*2); ctx.fill(); ctx.stroke();
                
                log.knives.forEach(angle => {
                    ctx.save(); ctx.rotate(angle);
                    ctx.fillStyle = '#fff'; ctx.fillRect(-3, 80, 6, 60);
                    ctx.restore();
                });
                ctx.restore();

                // Draw Firing Knife
                ctx.fillStyle = '#fff'; ctx.fillRect(canvas.width/2-3, currentKnifeY, 6, 60);
                
                if(isFiring) {
                    currentKnifeY -= 35;
                    if(currentKnifeY <= 340) {
                        let hitAngle = (Math.PI/2 - log.a) % (Math.PI*2);
                        if(hitAngle < 0) hitAngle += Math.PI*2;
                        
                        if(log.knives.some(a => Math.abs(a - hitAngle) < 0.2)) {
                            state = 'over'; haptic('heavy'); msgEl.innerText = L.over; isFiring = false;
                        } else {
                            log.knives.push(hitAngle); score++; scoreEl.innerText = score;
                            haptic('medium'); log.shake = 10; isFiring = false; currentKnifeY = canvas.height-150;
                            log.v += 0.002;
                        }
                    }
                }
                if(log.shake > 0) ctx.restore();
                gameId = requestAnimationFrame(run);
            }
            canvas.onclick = () => {
                if(state === 'over') { state = 'play'; log.knives = []; score = 0; log.v = 0.03; scoreEl.innerText = '0'; msgEl.innerText = ''; return; }
                if(!isFiring && state !== 'over') { isFiring = true; haptic('soft'); msgEl.innerText = ''; }
            };
            run();
        }

        function varColor() { return `hsl(${(Date.now()/20)%360}, 100%, 50%)`; }
    </script>
</body>
    </html>
    
