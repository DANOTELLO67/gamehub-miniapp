<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flying Cow</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body {
    margin: 0;
    background: #0f172a;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: auto;
    background: #1e293b;
  }
</style>
</head>
<body>

<canvas id="game" width="360" height="640"></canvas>

<script>
Telegram.WebApp.ready();

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let cow = { x: 80, y: 300, w: 40, h: 30, vy: 0 };
let gravity = 0.5;
let jump = -8;
let score = 0;
let gameOver = false;

let pipes = [{ x: 360, y: 200 }];

function update() {
  if (gameOver) return;

  cow.vy += gravity;
  cow.y += cow.vy;

  if (cow.y < 0 || cow.y + cow.h > 640) gameOver = true;

  pipes.forEach(p => {
    p.x -= 2;

    if (
      cow.x < p.x + 50 &&
      cow.x + cow.w > p.x &&
      (cow.y < p.y || cow.y + cow.h > p.y + 140)
    ) gameOver = true;

    if (p.x + 50 === cow.x) score++;
  });

  if (pipes[pipes.length - 1].x < 180) {
    pipes.push({ x: 360, y: Math.random() * 300 + 50 });
  }

  if (pipes[0].x < -60) pipes.shift();
}

function draw() {
  ctx.clearRect(0, 0, 360, 640);

  ctx.fillStyle = "white";
  ctx.fillRect(cow.x, cow.y, cow.w, cow.h);

  ctx.fillStyle = "#22c55e";
  pipes.forEach(p => {
    ctx.fillRect(p.x, 0, 50, p.y);
    ctx.fillRect(p.x, p.y + 140, 50, 640);
  });

  ctx.fillStyle = "white";
  ctx.fillText("Score: " + score, 10, 30);

  if (gameOver) {
    ctx.fillText("Game Over", 120, 320);
    ctx.fillText("Tap to restart", 90, 350);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

canvas.addEventListener("touchstart", () => {
  if (gameOver) location.reload();
  else cow.vy = jump;
});

loop();
</script>

</body>
</html>
